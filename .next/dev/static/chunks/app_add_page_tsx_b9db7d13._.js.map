{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/app/add/page.tsx"],"sourcesContent":["// app/add-food/page.tsx\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ntype FoodGroup =\n  | \"protein\"\n  | \"vegetable\"\n  | \"fruit\"\n  | \"grain\"\n  | \"dairy\"\n  | \"fat\"\n  | \"seasonings\"\n  | \"starch\";\n\nconst FOOD_GROUPS: FoodGroup[] = [\n  \"protein\",\n  \"vegetable\",\n  \"fruit\",\n  \"grain\",\n  \"dairy\",\n  \"fat\",\n  \"seasonings\",\n  \"starch\",\n];\n\ntype USDARawFood = {\n  fdcId: number;\n  description: string;\n  additionalDescriptions?: string;\n  foodNutrients?: any[];\n};\n\ntype StructuredFood = {\n  id: string;\n  group: FoodGroup;\n  term?: string;\n  name: string;\n  nutrients: Record<string, number>;\n};\n\n\nexport default function AddFoodPage() {\n  const [usdaKey, setUsdaKey] = useState(\"\");\n  const [openaiKey, setOpenaiKey] = useState(\"\");\n  const [query, setQuery] = useState(\"\");\n  const [results, setResults] = useState<USDARawFood[]>([]);\n  const [addingId, setAddingId] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    setUsdaKey(localStorage.getItem(\"USDA_API_KEY\") || \"\");\n    setOpenaiKey(localStorage.getItem(\"OPENAI_API_KEY\") || \"\");\n  }, []);\n\n  function saveKeys() {\n    localStorage.setItem(\"USDA_API_KEY\", usdaKey);\n    localStorage.setItem(\"OPENAI_API_KEY\", openaiKey);\n  }\n\n  async function searchFoods() {\n    if (!query || !usdaKey) {\n      setError(\"Missing USDA API key or query\");\n      return;\n    }\n\n    setError(null);\n\n    try {\n      const res = await fetch(\n        `https://api.nal.usda.gov/fdc/v1/foods/search?query=${encodeURIComponent(\n          query\n        )}&api_key=${usdaKey}`\n      );\n      const data = await res.json();\n      setResults(data.foods || []);\n    } catch {\n      setError(\"Failed to search USDA\");\n    }\n  }\n\n    async function addFood(food: USDARawFood) {\n        setAddingId(String(food.fdcId));\n        setError(null);\n\n        try {\n            const res = await fetch(\"/api/foods/add\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n                food,\n                openaiKey, // send key to server\n            }),\n            });\n\n            const text = await res.text();\n\n            if (!res.ok) {\n            console.error(\"Server error:\", text);\n            throw new Error(text);\n            }\n\n            console.log(\"Added successfully:\", text);\n        } catch (err: any) {\n            console.error(err);\n            setError(err.message || \"Failed to add food\");\n        } finally {\n            setAddingId(null);\n        }\n    }\n\n\n  return (\n    <div style={{ padding: 16 }}>\n      <h1>Add Food</h1>\n\n      <div style={{ display: \"grid\", gap: 8, marginBottom: 16 }}>\n        <input\n          placeholder=\"USDA API Key\"\n          value={usdaKey}\n          onChange={(e) => setUsdaKey(e.target.value)}\n        />\n        <input\n          placeholder=\"OpenAI API Key\"\n          value={openaiKey}\n          onChange={(e) => setOpenaiKey(e.target.value)}\n        />\n        <button onClick={saveKeys}>Save API Keys (local)</button>\n      </div>\n\n      <div style={{ display: \"flex\", gap: 8 }}>\n        <input\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n          placeholder=\"Search food\"\n          style={{ flex: 1 }}\n        />\n        <button onClick={searchFoods}>Search</button>\n      </div>\n\n      {error && <p style={{ color: \"red\" }}>{error}</p>}\n\n      <ul style={{ marginTop: 16 }}>\n        {results.map((food) => (\n          <li\n            key={food.fdcId}\n            style={{\n              borderBottom: \"1px solid #ddd\",\n              padding: \"8px 0\",\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n            }}\n          >\n            <div>{food.description}</div>\n\n            <button\n              onClick={() => addFood(food)}\n              disabled={addingId === String(food.fdcId)}\n            >\n              {addingId === String(food.fdcId) ? \"Addingâ€¦\" : \"Add\"}\n            </button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}