{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/data/nutrients.json"],"sourcesContent":["{\"nutrients\":[{\"id\":\"protein\",\"label\":\"Protein\",\"unit\":\"g\",\"category\":\"macronutrient\",\"usda_names\":[\"Protein\"]},{\"id\":\"carbohydrate\",\"label\":\"Carbo\",\"unit\":\"g\",\"category\":\"macronutrient\",\"usda_names\":[\"Carbohydrate, by difference\"]},{\"id\":\"fat\",\"label\":\"Fat\",\"unit\":\"g\",\"category\":\"macronutrient\",\"usda_names\":[\"Total lipid (fat)\"]},{\"id\":\"fiber\",\"label\":\"Fiber\",\"unit\":\"g\",\"category\":\"macronutrient\",\"usda_names\":[\"Fiber, total dietary\"]},{\"id\":\"calories\",\"label\":\"Calories\",\"unit\":\"kcal\",\"category\":\"macronutrient\",\"usda_names\":[\"Energy\"]},{\"id\":\"iron\",\"label\":\"Iron\",\"unit\":\"mg\",\"category\":\"mineral\",\"usda_names\":[\"Iron, Fe\"]},{\"id\":\"calcium\",\"label\":\"Calcium\",\"unit\":\"mg\",\"category\":\"mineral\",\"usda_names\":[\"Calcium, Ca\"]},{\"id\":\"magnesium\",\"label\":\"Magnesium\",\"unit\":\"mg\",\"category\":\"mineral\",\"usda_names\":[\"Magnesium, Mg\"]},{\"id\":\"potassium\",\"label\":\"Potassium\",\"unit\":\"mg\",\"category\":\"mineral\",\"usda_names\":[\"Potassium, K\"]},{\"id\":\"sodium\",\"label\":\"Sodium\",\"unit\":\"mg\",\"category\":\"mineral\",\"usda_names\":[\"Sodium, Na\"]},{\"id\":\"zinc\",\"label\":\"Zinc\",\"unit\":\"mg\",\"category\":\"mineral\",\"usda_names\":[\"Zinc, Zn\"]},{\"id\":\"vitamin_a\",\"label\":\"Vitamin A\",\"unit\":\"µg\",\"category\":\"vitamin\",\"usda_names\":[\"Vitamin A, RAE\"]},{\"id\":\"vitamin_c\",\"label\":\"Vitamin C\",\"unit\":\"mg\",\"category\":\"vitamin\",\"usda_names\":[\"Vitamin C, total ascorbic acid\"]},{\"id\":\"vitamin_d\",\"label\":\"Vitamin D\",\"unit\":\"IU\",\"category\":\"vitamin\",\"usda_names\":[\"Vitamin D (D2 + D3)\"]},{\"id\":\"vitamin_e\",\"label\":\"Vitamin E\",\"unit\":\"mg\",\"category\":\"vitamin\",\"usda_names\":[\"Vitamin E (alpha-tocopherol)\"]},{\"id\":\"vitamin_k\",\"label\":\"Vitamin K\",\"unit\":\"µg\",\"category\":\"vitamin\",\"usda_names\":[\"Vitamin K (phylloquinone)\"]},{\"id\":\"vitamin_b12\",\"label\":\"Vitamin B12\",\"unit\":\"µg\",\"category\":\"vitamin\",\"usda_names\":[\"Vitamin B-12\"]},{\"id\":\"folate\",\"label\":\"Folate\",\"unit\":\"µg\",\"category\":\"vitamin\",\"usda_names\":[\"Folate, total\"]}]}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 3, "column": 1910}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/lib/nutrientRegistry.ts"],"sourcesContent":["// this file handles nutrients data format for food\nimport nutrientData from \"@/data/nutrients.json\";\n\nexport type NutrientDef = {\n  id: string;\n  label: string;\n  unit: string;\n  usda_names: string[];\n};\n\nconst nutrients: NutrientDef[] = nutrientData.nutrients;\n\n// Map USDA name → nutrient ID\nconst usdaNameToId = new Map<string, NutrientDef>();\n\nfor (const n of nutrients) {\n  for (const name of n.usda_names) {\n    usdaNameToId.set(name, n);\n  }\n}\n\nexport function getNutrientByUsdaName(name: string): NutrientDef | undefined {\n  return usdaNameToId.get(name);\n}\n\nexport function getNutrientById(id: string): NutrientDef | undefined {\n  return nutrients.find(n => n.id === id);\n}"],"names":[],"mappings":";;;;;;AAAA,mDAAmD;AACnD;;AASA,MAAM,YAA2B,oGAAY,CAAC,SAAS;AAEvD,8BAA8B;AAC9B,MAAM,eAAe,IAAI;AAEzB,KAAK,MAAM,KAAK,UAAW;IACzB,KAAK,MAAM,QAAQ,EAAE,UAAU,CAAE;QAC/B,aAAa,GAAG,CAAC,MAAM;IACzB;AACF;AAEO,SAAS,sBAAsB,IAAY;IAChD,OAAO,aAAa,GAAG,CAAC;AAC1B;AAEO,SAAS,gBAAgB,EAAU;IACxC,OAAO,UAAU,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;AACtC"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/lib/recommendationEngine.ts"],"sourcesContent":["import { getDB } from \"@/lib/db\";\nimport {\n  RECOMMENDATION_SETS,\n  type RecommendationSetId,\n} from \"@/data/recommendations\";\n\ntype Sex = \"male\" | \"female\";\n\nexport type Profile = {\n  recommendationSet: RecommendationSetId;\n  sex: Sex;\n  age: number;\n};\n\nexport async function getDailyTargets(\n  profile: Profile\n): Promise<Record<string, number>> {\n  const db = await getDB();\n  const overrides = db.nutrientOverrides ?? {};\n\n  const set = RECOMMENDATION_SETS[profile.recommendationSet];\n  const targets: Record<string, number> = {};\n\n  for (const r of set.recommendations) {\n    if (\n      (r.sex === \"any\" || r.sex === profile.sex) &&\n      profile.age >= r.age_min &&\n      profile.age <= r.age_max\n    ) {\n      targets[r.nutrient_id] = r.daily_value;\n    }\n  }\n\n  // overrides always win\n  for (const [id, value] of Object.entries(overrides)) {\n    targets[id] = value as number;\n  }\n\n  return targets;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAaO,eAAe,gBACpB,OAAgB;IAEhB,MAAM,KAAK,MAAM,IAAA,kHAAK;IACtB,MAAM,YAAY,GAAG,iBAAiB,IAAI,CAAC;IAE3C,MAAM,MAAM,uJAAmB,CAAC,QAAQ,iBAAiB,CAAC;IAC1D,MAAM,UAAkC,CAAC;IAEzC,KAAK,MAAM,KAAK,IAAI,eAAe,CAAE;QACnC,IACE,CAAC,EAAE,GAAG,KAAK,SAAS,EAAE,GAAG,KAAK,QAAQ,GAAG,KACzC,QAAQ,GAAG,IAAI,EAAE,OAAO,IACxB,QAAQ,GAAG,IAAI,EAAE,OAAO,EACxB;YACA,OAAO,CAAC,EAAE,WAAW,CAAC,GAAG,EAAE,WAAW;QACxC;IACF;IAEA,uBAAuB;IACvB,KAAK,MAAM,CAAC,IAAI,MAAM,IAAI,OAAO,OAAO,CAAC,WAAY;QACnD,OAAO,CAAC,GAAG,GAAG;IAChB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/lib/nutritionEngine.ts"],"sourcesContent":["// lib/nutritionEngine.ts — Firebase-compatible, no React hooks\n\nimport { getNutrientById } from \"@/lib/nutrientRegistry\";\nimport { getDailyTargets } from \"@/lib/recommendationEngine\";\nimport { getDB, initDB, updateDB } from \"@/lib/db\";\n\n\n/**\n * CONFIG\n * 1 = Sunday, 2 = Monday\n * MUST match History page\n */\nexport const WEEK_START = 2;\n\n// ---------- Types ----------\nexport type NutrientContribution = {\n  foodName: string;\n  amount: number;\n};\n\nexport type NutrientDetail = {\n  name: string;\n  unit: string;\n  intake: number;\n  target: number;\n  progress: number;\n  contributions: NutrientContribution[];\n};\n\nexport type NutrientProgress = {\n  id: string;\n  name: string;\n  progress: number;\n};\n\nexport type WeeklyProgress = {\n  overall: number;\n  all: NutrientProgress[];\n  focus: NutrientProgress[];\n};\n\nexport type FoodNutrientsPer100g = Record<string, number>;\n\nexport type LoggedFood = {\n  term: string;\n  name: string;\n  grams: number;\n  nutrientsPer100g: FoodNutrientsPer100g;\n  loggedAt: number;\n  // optional precomputed per-entry nutrient amounts (amount contributed by this logged food)\n  nutrients?: Record<string, number>;\n};\n\n// ---------- Week Helpers ----------\nfunction getWeekRange(baseDate: Date = new Date()) {\n  const d = new Date(baseDate);\n  const diff = (d.getDay() - WEEK_START + 7) % 7;\n  d.setDate(d.getDate() - diff);\n  d.setHours(0, 0, 0, 0);\n\n  const start = new Date(d);\n  const end = new Date(d);\n  end.setDate(end.getDate() + 7);\n\n  return {\n    start: start.toISOString().slice(0, 10),\n    end: end.toISOString().slice(0, 10),\n  };\n}\n\nfunction isWithinWeek(dateIso: string, startIso: string, endIso: string) {\n  return dateIso >= startIso && dateIso < endIso;\n}\n\n// ---------- Core Logic ----------\nexport async function logFood(\n  food: {\n    term: string;\n    name: string;\n    nutrients: Record<string, number>;\n  },\n  grams: number\n) {\n  const date = new Date().toISOString().slice(0, 10);\n\n  await updateDB((db) => {\n    if (!db.foodLog[date]) db.foodLog[date] = [];\n    // store both the original per-100g values and a precomputed per-entry\n    // nutrients map (scaled by grams) so older entries and other UI\n    // components can read either shape.\n    const scaled: Record<string, number> = {};\n    for (const [k, v] of Object.entries(food.nutrients ?? {})) {\n      if (typeof v === \"number\") scaled[k] = (v * grams) / 100;\n    }\n\n    db.foodLog[date].push({\n      term: food.term,\n      name: food.name,\n      grams,\n      nutrientsPer100g: food.nutrients,\n      // per-entry nutrient amounts (e.g., amount contributed by this logged food)\n      nutrients: scaled,\n      loggedAt: Date.now(),\n    });\n  });\n}\n\n// ---------- Weekly Progress ----------\nexport async function getWeeklyProgress(\n  baseDate: Date = new Date()\n): Promise<WeeklyProgress> {\n  await initDB();\n  const db = await getDB();\n\n  // debug: log keys / a small sample to help diagnose why totals are zero\n  try {\n    // eslint-disable-next-line no-console\n    console.log(\"getWeeklyProgress: foodLog keys:\", Object.keys(db.foodLog || {}).slice(0, 10));\n    const firstKey = Object.keys(db.foodLog || {})[0];\n    if (firstKey) {\n      // eslint-disable-next-line no-console\n      console.log(\"getWeeklyProgress: sample entry:\", db.foodLog[firstKey] && db.foodLog[firstKey][0]);\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.log(\"getWeeklyProgress: failed to log sample\", e);\n  }\n\n  const { start, end } = getWeekRange(baseDate);\n  // Prefer the profile stored in the app DB (keeps behaviour consistent with ProfileProvider)\n  // Fall back to the exported userProfile defaults if DB doesn't have values.\n  const dbProfile = db.userProfile ?? {};\n  const profile = {\n    recommendationSet: dbProfile.recommendationSet ?? \"fda_dv_2024\",\n    sex: (dbProfile.sex as \"male\" | \"female\") ?? \"female\",\n    age: typeof dbProfile.age === \"number\" ? dbProfile.age : 30,\n  };\n\n  const dailyTargets = await getDailyTargets(profile as any);\n\n  const weeklyTargets: Record<string, number> = {};\n  for (const [id, daily] of Object.entries(dailyTargets)) {\n    weeklyTargets[id] = daily * 7;\n  }\n\n  const totals: Record<string, number> = {};\n\n  for (const [date, foods] of Object.entries(db.foodLog)) {\n    if (!isWithinWeek(date, start, end)) continue;\n\n    for (const entry of foods as LoggedFood[]) {\n      // Support both shapes:\n      // - legacy/other entries may have `nutrients` (already scaled for the\n      //   logged grams),\n      // - new entries have `nutrientsPer100g` + `grams`.\n      if (entry.nutrients && Object.keys(entry.nutrients).length) {\n        for (const [nutrientId, amount] of Object.entries(entry.nutrients)) {\n          if (typeof amount !== \"number\") continue;\n          totals[nutrientId] = (totals[nutrientId] ?? 0) + amount;\n        }\n        continue;\n      }\n\n      if (!entry.nutrientsPer100g) continue;\n\n      const factor = entry.grams / 100;\n\n      for (const [nutrientId, per100g] of Object.entries(entry.nutrientsPer100g)) {\n        if (typeof per100g !== \"number\") continue;\n        totals[nutrientId] = (totals[nutrientId] ?? 0) + per100g * factor;\n      }\n    }\n  }\n\n\n  const all: NutrientProgress[] = [];\n\n  for (const [nutrientId, target] of Object.entries(weeklyTargets)) {\n    const intake = totals[nutrientId];\n    if (!intake || !target) continue;\n\n    const def = getNutrientById(nutrientId);\n    if (!def) continue;\n\n    all.push({\n      id: nutrientId,\n      name: def.label,\n      progress: Math.min(\n        100,\n        Math.round((intake / target) * 100)\n      ),\n    });\n  }\n\n  const overall =\n    all.length === 0\n      ? 0\n      : all.reduce((s, n) => s + n.progress, 0) / all.length;\n\n  return {\n    overall: Math.round(overall),\n    all,\n    focus: all\n      .filter((n) => n.progress < 100)\n      .sort((a, b) => a.progress - b.progress),\n  };\n}\n\n// ---------- Nutrient Detail ----------\nexport async function getNutrientDetail(\n  nutrientId: string,\n  baseDate: Date = new Date()\n): Promise<NutrientDetail | null> {\n  await initDB();\n  const db = await getDB();\n\n  const { start, end } = getWeekRange(baseDate);\n  // Use DB-backed profile (same defaults as elsewhere)\n  const dbProfile = db.userProfile ?? {};\n  const profile = {\n    recommendationSet: dbProfile.recommendationSet ?? \"fda_dv_2024\",\n    sex: (dbProfile.sex as \"male\" | \"female\") ?? \"female\",\n    age: typeof dbProfile.age === \"number\" ? dbProfile.age : 30,\n  };\n\n  const dailyTargets = await getDailyTargets(profile as any);\n\n  const target = dailyTargets[nutrientId]\n    ? dailyTargets[nutrientId] * 7\n    : null;\n  if (!target) return null;\n\n  const def = getNutrientById(nutrientId);\n  if (!def) return null;\n\n  let total = 0;\n  const grouped: Record<string, number> = {};\n\n  for (const [date, foods] of Object.entries(db.foodLog)) {\n    if (!isWithinWeek(date, start, end)) continue;\n\n    for (const entry of foods as LoggedFood[]) {\n      // Accept per-entry nutrients if present\n      if (entry.nutrients && typeof entry.nutrients[nutrientId] === \"number\") {\n        const amount = entry.nutrients[nutrientId] as number;\n        total += amount;\n        grouped[entry.name] = (grouped[entry.name] ?? 0) + amount;\n        continue;\n      }\n\n      if (!entry.nutrientsPer100g) continue;\n\n      const per100g = entry.nutrientsPer100g[nutrientId];\n      if (!per100g) continue;\n\n      const amount = (entry.grams / 100) * per100g;\n      total += amount;\n\n      grouped[entry.name] = (grouped[entry.name] ?? 0) + amount;\n    }\n  }\n\n  const contributions = Object.entries(grouped)\n    .map(([foodName, amount]) => ({\n      foodName,\n      amount: Number(amount.toFixed(2)),\n    }))\n    .sort((a, b) => b.amount - a.amount)\n    .slice(0, 5);\n\n  return {\n    name: def.label,\n    unit: def.unit,\n    intake: Number(total.toFixed(2)),\n    target,\n    progress: Math.min(\n      100,\n      Math.round((total / target) * 100)\n    ),\n    contributions,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/components/BottomNav.tsx"],"sourcesContent":["import Link from \"next/link\";\nimport { signOut } from \"firebase/auth\";\nimport { auth } from \"@/lib/firebase\";\n\nfunction logoutHandler () {\n  signOut(auth);\n  window.location.href = \"/\"; // Redirect to login page\n}\n\nexport default function BottomNav() {\n  return (\n    <nav className=\"fixed bottom-0 left-0 right-0 bg-[var(--background)] border-t border-[var(--border)]\">\n      <div className=\"max-w-md mx-auto flex justify-around py-3\">\n        <Link href=\"/\">Home</Link>\n        <Link href=\"/log\">Log</Link>\n        <Link href=\"/history\">History</Link>\n        <Link href=\"/recommendations\">Recommendations</Link>\n        <Link href=\"/add\">Add</Link>\n        <button onClick={logoutHandler}>Logout</button>\n      </div>\n    </nav>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;;;;;AAEA,SAAS;IACP,IAAA,6KAAO,EAAC,uHAAI;IACZ,OAAO,QAAQ,CAAC,IAAI,GAAG,KAAK,yBAAyB;AACvD;AAEe,SAAS;IACtB,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC,uKAAI;oBAAC,MAAK;8BAAI;;;;;;8BACf,8OAAC,uKAAI;oBAAC,MAAK;8BAAO;;;;;;8BAClB,8OAAC,uKAAI;oBAAC,MAAK;8BAAW;;;;;;8BACtB,8OAAC,uKAAI;oBAAC,MAAK;8BAAmB;;;;;;8BAC9B,8OAAC,uKAAI;oBAAC,MAAK;8BAAO;;;;;;8BAClB,8OAAC;oBAAO,SAAS;8BAAe;;;;;;;;;;;;;;;;;AAIxC"}},
    {"offset": {"line": 349, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/components/FoodNutrients.tsx"],"sourcesContent":["\"use client\";\n\nimport { getNutrientById } from \"@/lib/nutrientRegistry\";\n\ntype Props = {\n  nutrients: Record<string, number>;\n  grams?: number;\n};\n\nexport default function FoodNutrients({ nutrients, grams }: Props) {\n  const entries = Object.entries(nutrients ?? {});\n\n  if (!entries.length) {\n    return (\n      <div className=\"rounded-xl p-4 border bg-[var(--background)] text-sm text-neutral-400\">\n        No nutrient information available\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 gap-3\">\n      {entries.map(([key, amount]) => {\n        const def = getNutrientById(key);\n        const label = def?.label ?? key;\n        const unit = def?.unit ?? \"\";\n\n        // amount is per 100g in many data shapes; treat as per-100g unless grams omitted\n        const displayAmount = grams ? (amount * grams) / 100 : amount;\n\n        return (\n          <div\n            key={key}\n            className=\"rounded-xl bg-[var(--background)] border border-[var(--border)] p-3 text-sm\"\n          >\n            <div className=\"flex justify-between items-baseline\">\n              <div className=\"font-medium text-[var(--foreground)] text-xs\">\n                {label}\n              </div>\n              <div className=\"text-[var(--foreground)] text-xs\">\n                {Number.isFinite(displayAmount) ? (\n                  <>{Math.round(displayAmount * 100) / 100} {unit}</>\n                ) : (\n                  \"-\"\n                )}\n              </div>\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AASe,SAAS,cAAc,EAAE,SAAS,EAAE,KAAK,EAAS;IAC/D,MAAM,UAAU,OAAO,OAAO,CAAC,aAAa,CAAC;IAE7C,IAAI,CAAC,QAAQ,MAAM,EAAE;QACnB,qBACE,8OAAC;YAAI,WAAU;sBAAwE;;;;;;IAI3F;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACZ,QAAQ,GAAG,CAAC,CAAC,CAAC,KAAK,OAAO;YACzB,MAAM,MAAM,IAAA,0IAAe,EAAC;YAC5B,MAAM,QAAQ,KAAK,SAAS;YAC5B,MAAM,OAAO,KAAK,QAAQ;YAE1B,iFAAiF;YACjF,MAAM,gBAAgB,QAAQ,AAAC,SAAS,QAAS,MAAM;YAEvD,qBACE,8OAAC;gBAEC,WAAU;0BAEV,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCACZ;;;;;;sCAEH,8OAAC;4BAAI,WAAU;sCACZ,OAAO,QAAQ,CAAC,+BACf;;oCAAG,KAAK,KAAK,CAAC,gBAAgB,OAAO;oCAAI;oCAAE;;+CAE3C;;;;;;;;;;;;eAXD;;;;;QAiBX;;;;;;AAGN"}},
    {"offset": {"line": 427, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/app/log/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { logFood } from \"@/lib/nutritionEngine\";\nimport { useRouter } from \"next/navigation\";\nimport { useAuth } from \"@/app/providers/AuthProviders\";\nimport BottomNav from \"@/components/BottomNav\";\nimport FoodNutrients from \"@/components/FoodNutrients\";\n\ntype FoodGroup =\n  | \"starch\"\n  | \"meat\"\n  | \"fish\"\n  | \"seafood\"\n  | \"vegetables\"\n  | \"legumes\"\n  | \"fruits\"\n  | \"condiments\"\n  | \"seasonings\";\n\ntype Food = {\n  id: string;\n  term: string;\n  name: string;\n  group: FoodGroup;\n  nutrients: Record<string, number>; // per 100g\n};\n\nconst FOOD_GROUPS: FoodGroup[] = [\n  \"starch\",\n  \"meat\",\n  \"fish\",\n  \"seafood\",\n  \"vegetables\",\n  \"legumes\",\n  \"fruits\",\n  \"condiments\",\n  \"seasonings\",\n];\n\nexport default function LogFoodPage() {\n  const router = useRouter();\n\n  const [foods, setFoods] = useState<Food[]>([]);\n  const [activeGroup, setActiveGroup] = useState<FoodGroup | null>(null);\n  const [selectedFood, setSelectedFood] = useState<Food | null>(null);\n  const [grams, setGrams] = useState(\"\");\n  const [page, setPage] = useState(1);\n  const [limit] = useState(50);\n  const [loadingFoods, setLoadingFoods] = useState(false);\n  const [fetchError, setFetchError] = useState<string | null>(null);\n\n  const { user } = useAuth();\n\n  useEffect(() => {\n    // Fetch foods filtered by group with pagination whenever activeGroup or page changes\n    if (!activeGroup) return;\n    if (!user) return;\n\n    let aborted = false;\n\n    (async () => {\n      setLoadingFoods(true);\n      setFetchError(null);\n      try {\n        const token = await user.getIdToken();\n        const res = await fetch(\n          `/api/foods?group=${encodeURIComponent(activeGroup)}&page=${page}&limit=${limit}`,\n          {\n            headers: { Authorization: `Bearer ${token}` },\n          }\n        );\n\n        if (!res.ok) {\n          const body = await res.json().catch(() => ({}));\n          if (!aborted) setFetchError(body?.error ?? `HTTP ${res.status}`);\n          return;\n        }\n\n        const data = await res.json();\n        if (aborted) return;\n        setFoods(data?.foods ?? []);\n      } catch (e: any) {\n        if (!aborted) setFetchError(String(e?.message ?? e));\n      } finally {\n        if (!aborted) setLoadingFoods(false);\n      }\n    })();\n\n    return () => {\n      aborted = true;\n    };\n  }, [activeGroup, page, limit, user]);\n\n  const groupFoods = activeGroup\n    ? foods.filter((f) => f.group === activeGroup)\n    : [];\n\n  async function handleAdd() {\n    if (!selectedFood || !grams) return;\n\n    await logFood(\n      {\n        term: selectedFood.term,\n        name: selectedFood.name,\n        nutrients: selectedFood.nutrients, // per 100g\n      },\n      Number(grams)\n    );\n\n    router.push(\"/home\");\n    router.refresh();\n  }\n\n\n\n  return (\n    <div className=\"pb-24\">\n      <div className=\"p-4 space-y-4\">\n        {/* Food Groups */}\n        <div className=\"flex gap-2 flex-wrap\">\n          {FOOD_GROUPS.map((group) => (\n            <button\n              key={group}\n              onClick={() => {\n                setActiveGroup(group);\n                setSelectedFood(null);\n                setPage(1);\n              }}\n              className={`px-3 py-1 rounded-full text-sm border bg-[var(--background)] border-[var(--border)] ${\n                activeGroup === group ? \"bg-primary text-white\" : \"\"\n              }`}\n            >\n              {group}\n            </button>\n          ))}\n        </div>\n\n        {/* Foods + Nutrients layout */}\n        {activeGroup && (\n          <div className=\"grid grid-cols-5 gap-4\">\n            <div className=\"col-span-2 space-y-2\">\n              {loadingFoods ? (\n                <div className=\"rounded-xl p-4 border bg-[var(--background)] text-sm text-neutral-400\">Loading foods…</div>\n              ) : fetchError ? (\n                <div className=\"rounded-xl p-4 border bg-[var(--background)] text-sm text-red-500\">{fetchError}</div>\n              ) : groupFoods.length > 0 ? (\n                groupFoods.map((food) => (\n                  <button\n                    key={food.id}\n                    onClick={() => setSelectedFood(food)}\n                    className={`w-full text-left px-3 py-2 rounded-lg border bg-[var(--background)] border-[var(--border)] ${\n                      selectedFood?.id === food.id ? \"ring-2 ring-primary\" : \"\"\n                    }`}\n                  >\n                    <div className=\"font-medium text-[var(--foreground)]\">\n                      {food.term}\n                    </div>\n                  </button>\n                ))\n              ) : (\n                <div className=\"rounded-xl p-4 border bg-[var(--background)] text-sm text-neutral-400\">No foods in this group.</div>\n              )}\n\n              <div className=\"flex items-center gap-2 mt-2\">\n                <button\n                  onClick={() => setPage((p) => Math.max(1, p - 1))}\n                  disabled={page <= 1 || loadingFoods}\n                  className=\"px-3 py-1 rounded border bg-[var(--background)]\"\n                >\n                  Prev\n                </button>\n                <div className=\"text-sm text-neutral-500\">{page}</div>\n                <button\n                  onClick={() => setPage((p) => p + 1)}\n                  disabled={loadingFoods}\n                  className=\"px-3 py-1 rounded border bg-[var(--background)]\"\n                >\n                  Next\n                </button>\n              </div>\n            </div>\n\n            <div className=\"col-span-3\">\n              {selectedFood ? (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between flex-row\">\n                    <div>\n                      <input\n                        type=\"number\"\n                        placeholder=\"Grams eaten\"\n                        value={grams}\n                        onChange={(e) => setGrams(e.target.value)}\n                        className=\"w-[100%] rounded-lg border px-3 py-2 bg-transparent\"\n                      />\n                    </div>\n                    <button\n                      onClick={handleAdd}\n                      className=\"w-[60%] rounded-lg bg-primary py-2 px-4 text-white font-medium\"\n                    >\n                      Log food\n                    </button>\n                  </div>\n\n                  <div>\n                    <h3 className=\"text-sm text-neutral-400 uppercase mb-2\">Nutrients</h3>\n                    <FoodNutrients nutrients={selectedFood.nutrients} grams={Number(grams) || undefined} />\n                  </div>\n                </div>\n              ) : (\n                <div className=\"rounded-xl p-4 border bg-[var(--background)] text-sm text-neutral-400\">\n                  Select a food to see its nutrients\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}