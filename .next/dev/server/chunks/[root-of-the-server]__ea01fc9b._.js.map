{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/lib/firebaseAdmin.ts"],"sourcesContent":["// lib/firebaseAdmin.ts\nimport { getApps, initializeApp, cert } from \"firebase-admin/app\";\nimport { getAuth } from \"firebase-admin/auth\";\nimport { getFirestore } from \"firebase-admin/firestore\";\n\nif (!getApps().length) {\n  initializeApp({\n    credential: cert({\n      projectId: process.env.FIREBASE_PROJECT_ID,\n      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\n    }),\n  });\n}\n\nexport const adminDb = getFirestore();\n\nexport async function verifyAuth(req: Request) {\n  const authHeader = req.headers.get(\"authorization\");\n  if (!authHeader?.startsWith(\"Bearer \")) return null;\n\n  const token = authHeader.slice(7);\n  try {\n    return await getAuth().verifyIdToken(token);\n  } catch {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA,uBAAuB;AACvB;AACA;AACA;;;;;;;;;;AAEA,IAAI,CAAC,IAAA,mNAAO,IAAG,MAAM,EAAE;IACrB,IAAA,yNAAa,EAAC;QACZ,YAAY,IAAA,gNAAI,EAAC;YACf,WAAW,QAAQ,GAAG,CAAC,mBAAmB;YAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;YAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;QAChE;IACF;AACF;AAEO,MAAM,UAAU,IAAA,oOAAY;AAE5B,eAAe,WAAW,GAAY;IAC3C,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,CAAC,YAAY,WAAW,YAAY,OAAO;IAE/C,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI;QACF,OAAO,MAAM,IAAA,qNAAO,IAAG,aAAa,CAAC;IACvC,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/hung.doan/Documents/GitHubPersonal/nutrition-app/app/api/foods/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { adminDb, verifyAuth } from \"@/lib/firebaseAdmin\";\n\nexport const runtime = \"nodejs\";\n\nexport async function GET(req: Request) {\n  try {\n    const user = await verifyAuth(req);\n    if (!user) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const url = new URL(req.url);\n    const page = Math.max(1, Number(url.searchParams.get(\"page\") ?? \"1\"));\n    const limit = Math.max(1, Math.min(200, Number(url.searchParams.get(\"limit\") ?? \"50\")));\n    const start = (page - 1) * limit;\n\n    let foods: any[] = [];\n\n    try {\n      const snapshot = await adminDb\n        .collection(\"foods\")\n        .limit(limit)\n        .offset(start)\n        .get();\n\n      snapshot.forEach((doc) => {\n        const f = doc.data();\n\n        foods.push({\n          id: doc.id,\n          fdcId: f.fdcId ?? null,\n          description: f.description ?? f.term ?? null,\n          brandName: f.brandOwner ?? f.brandName ?? null,\n          group: f.group,\n          nutrients: f.nutrients,\n          servingSize:\n            typeof f.servingSize === \"number\"\n              ? f.servingSize\n              : Number(f.servingSize) || 100,\n          servingSizeUnit: f.servingSizeUnit ?? \"grams\",\n        });\n      });\n    } catch (err: any) {\n      const msg = String(err?.message ?? err);\n\n      if (msg.includes(\"requires an index\") || msg.includes(\"FAILED_PRECONDITION\")) {\n        const snapshotAll = await adminDb.collection(\"foods\").get();\n        const all: any[] = [];\n\n        snapshotAll.forEach((doc) => {\n          const f = doc.data();\n\n          all.push({\n            id: doc.id,\n            fdcId: f.fdcId ?? null,\n            description: f.description ?? null,\n            brandName: f.brandOwner ?? f.brandName ?? null,\n            term: f.description ?? null,\n            name: f.brandOwner ?? f.brandName ?? null,\n            group: f.group,\n            nutrients: f.nutrients,\n            servingSize:\n              typeof f.servingSize === \"number\"\n                ? f.servingSize\n                : Number(f.servingSize) || 100,\n            servingSizeUnit: f.servingSizeUnit ?? \"grams\",\n          });\n        });\n\n        all.sort((a, b) =>\n          (a.description ?? \"\").localeCompare(b.description ?? \"\")\n        );\n\n        foods = all.slice(start, start + limit);\n      } else {\n        throw err;\n      }\n    }\n\n    return NextResponse.json({\n      page,\n      limit,\n      count: foods.length,\n      foods,\n    });\n  } catch (err: any) {\n    return NextResponse.json(\n      { error: \"Failed to fetch foods\", detail: err?.message ?? String(err) },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,oIAAU,EAAC;QAC9B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,OAAO,KAAK,GAAG,CAAC,GAAG,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,WAAW;QAChE,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY;QAChF,MAAM,QAAQ,CAAC,OAAO,CAAC,IAAI;QAE3B,IAAI,QAAe,EAAE;QAErB,IAAI;YACF,MAAM,WAAW,MAAM,iIAAO,CAC3B,UAAU,CAAC,SACX,KAAK,CAAC,OACN,MAAM,CAAC,OACP,GAAG;YAEN,SAAS,OAAO,CAAC,CAAC;gBAChB,MAAM,IAAI,IAAI,IAAI;gBAElB,MAAM,IAAI,CAAC;oBACT,IAAI,IAAI,EAAE;oBACV,OAAO,EAAE,KAAK,IAAI;oBAClB,aAAa,EAAE,WAAW,IAAI,EAAE,IAAI,IAAI;oBACxC,WAAW,EAAE,UAAU,IAAI,EAAE,SAAS,IAAI;oBAC1C,OAAO,EAAE,KAAK;oBACd,WAAW,EAAE,SAAS;oBACtB,aACE,OAAO,EAAE,WAAW,KAAK,WACrB,EAAE,WAAW,GACb,OAAO,EAAE,WAAW,KAAK;oBAC/B,iBAAiB,EAAE,eAAe,IAAI;gBACxC;YACF;QACF,EAAE,OAAO,KAAU;YACjB,MAAM,MAAM,OAAO,KAAK,WAAW;YAEnC,IAAI,IAAI,QAAQ,CAAC,wBAAwB,IAAI,QAAQ,CAAC,wBAAwB;gBAC5E,MAAM,cAAc,MAAM,iIAAO,CAAC,UAAU,CAAC,SAAS,GAAG;gBACzD,MAAM,MAAa,EAAE;gBAErB,YAAY,OAAO,CAAC,CAAC;oBACnB,MAAM,IAAI,IAAI,IAAI;oBAElB,IAAI,IAAI,CAAC;wBACP,IAAI,IAAI,EAAE;wBACV,OAAO,EAAE,KAAK,IAAI;wBAClB,aAAa,EAAE,WAAW,IAAI;wBAC9B,WAAW,EAAE,UAAU,IAAI,EAAE,SAAS,IAAI;wBAC1C,MAAM,EAAE,WAAW,IAAI;wBACvB,MAAM,EAAE,UAAU,IAAI,EAAE,SAAS,IAAI;wBACrC,OAAO,EAAE,KAAK;wBACd,WAAW,EAAE,SAAS;wBACtB,aACE,OAAO,EAAE,WAAW,KAAK,WACrB,EAAE,WAAW,GACb,OAAO,EAAE,WAAW,KAAK;wBAC/B,iBAAiB,EAAE,eAAe,IAAI;oBACxC;gBACF;gBAEA,IAAI,IAAI,CAAC,CAAC,GAAG,IACX,CAAC,EAAE,WAAW,IAAI,EAAE,EAAE,aAAa,CAAC,EAAE,WAAW,IAAI;gBAGvD,QAAQ,IAAI,KAAK,CAAC,OAAO,QAAQ;YACnC,OAAO;gBACL,MAAM;YACR;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,OAAO,MAAM,MAAM;YACnB;QACF;IACF,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,QAAQ,KAAK,WAAW,OAAO;QAAK,GACtE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}